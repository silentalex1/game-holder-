<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BatProx API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        body { overflow-y: auto; background: #030303; }
        .api-container { max-width: 1000px; margin: 80px auto; padding: 30px; }
        .code-block { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.1); padding: 25px; border-radius: 12px; font-family: 'Courier New', monospace; color: #a855f7; margin: 20px 0; overflow-x: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .keyword { color: #f472b6; }
        .string { color: #34d399; }
        .func { color: #60a5fa; }
        h1 { font-size: 48px; margin-bottom: 20px; font-weight: 800; background: linear-gradient(to right, #fff, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 28px; margin-top: 50px; margin-bottom: 15px; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        p { color: #a1a1aa; line-height: 1.8; font-size: 16px; }
        .back-btn { position: fixed; top: 30px; left: 30px; color: white; border: 1px solid rgba(255,255,255,0.2); padding: 10px 24px; border-radius: 30px; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); transition: 0.3s; z-index: 100; text-decoration: none; }
        .back-btn:hover { border-color: #a855f7; background: rgba(168, 85, 247, 0.2); }
        
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .feature-card { background: #111; padding: 25px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; }
        .feature-title { color: white; font-weight: bold; margin-bottom: 10px; font-size: 18px; }
        .feature-desc { font-size: 13px; color: #888; margin-bottom: 15px; }
        .tier-tag { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; margin-left: 10px; }
        .tag-free { background: #10b981; color: #000; }
        .tag-paid { background: #f43f5e; color: #fff; }
        
        .key-box { background: #000; padding: 15px; border-radius: 8px; border: 1px dashed #333; margin-top: 15px; font-family: monospace; color: #a855f7; display: flex; justify-content: space-between; align-items: center; }
        .key-text { overflow: hidden; text-overflow: ellipsis; }
        .copy-btn { background: #333; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .copy-btn:hover { background: #a855f7; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-box { background: #111; border: 1px solid #333; padding: 30px; border-radius: 16px; width: 400px; text-align: center; position: relative; }
        .modal-box h3 { color: white; margin-bottom: 15px; font-size: 20px; }
        .modal-box input { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; margin-bottom: 15px; outline: none; }
        .modal-box input:focus { border-color: #a855f7; }
        .modal-btn { background: #a855f7; color: white; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; width: 100%; font-weight: bold; }
        .close-modal { position: absolute; top: 15px; right: 15px; color: #666; cursor: pointer; background: none; border: none; font-size: 18px; }
        
        .progress-container { width: 100%; background: #333; height: 6px; border-radius: 3px; margin-top: 20px; display: none; }
        .progress-bar { width: 0%; height: 100%; background: #a855f7; border-radius: 3px; transition: width 0.1s linear; }
        .loading-text { margin-top: 10px; color: #888; font-size: 12px; display: none; }
    </style>
</head>
<body>
    <a href="/" class="back-btn">‚Üê Back to BatProx</a>
    
    <div class="api-container">
        <h1>BatProx Developer API</h1>
        <p>Integrate the world's fastest proxy engine directly into your applications using BatScript. Get your freemium development key to instantly start building your dream.</p>

        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-title">API Keys <span class="tier-tag tag-free">Freemium</span></div>
                <div class="feature-desc">Generate up to 4 keys linked to your Discord ID.</div>
                <button onclick="openKeyModal()" style="width:100%; background:#a855f7; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold;">Generate New Key</button>
                <div id="keys-list"></div>
            </div>
            
            <div class="feature-card">
                <div class="feature-title">Traffic Inspector <span class="tier-tag tag-free">Free</span></div>
                <div class="feature-desc">Monitor basic request flow and origin headers via debug mode.</div>
            </div>
            
            <div class="feature-card">
                <div class="feature-title">Priority Bandwidth <span class="tier-tag tag-paid">Premium</span></div>
                <div class="feature-desc">Dedicated 10Gbps lanes with predictive caching engine.</div>
            </div>

            <div class="feature-card">
                <div class="feature-title">Edge Load Balancing <span class="tier-tag tag-paid">Premium</span></div>
                <div class="feature-desc">Smart routing through 48+ global low-congestion nodes.</div>
            </div>
        </div>

        <h2>Initialization</h2>
        <div class="code-block">
<span class="keyword">const</span> BatNode = <span class="keyword">new</span> <span class="func">BatProx</span>({
    key: <span class="string">"YOUR_KEY_HERE"</span>,
    domain: <span class="string">"gamesholder.site"</span>,
    mode: <span class="string">"production"</span>
});
        </div>

        <h2>Premium Features Config</h2>
        <div class="code-block">
BatNode.performance.settings = {
    loadBalancing: <span class="keyword">true</span>, 
    trafficPrediction: <span class="keyword">true</span>,
    priority: <span class="string">"high"</span>,
    edgeNodes: <span class="string">"auto"</span>
};

BatNode.optimizer.engine = {
    turbo: <span class="keyword">true</span>,
    latency: <span class="string">"ultra-low"</span>,
    congestion: <span class="string">"reduce"</span>
};
        </div>
    </div>

    <!-- Discord ID Modal -->
    <div class="modal-overlay" id="discord-modal">
        <div class="modal-box">
            <button class="close-modal" onclick="closeModal()">X</button>
            <h3 id="modal-title">Enter Discord User ID</h3>
            <input type="text" id="discord-id-input" placeholder="e.g. 123456789012345678">
            <button class="modal-btn" id="modal-action-btn" onclick="verifyDiscord()">Submit</button>
            
            <div class="progress-container" id="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="loading-text" id="loading-text">Checking if its a valid discord id..</div>
        </div>
    </div>

    <script>
        let currentStage = 'input'; 
        let cachedId = localStorage.getItem('bp_discord_id');

        function openKeyModal() {
            if(cachedId) {
                // If we already have ID, skip to generation
                generateKey(cachedId);
            } else {
                resetModal();
                document.getElementById('discord-modal').style.display = 'flex';
            }
        }

        function closeModal() {
            document.getElementById('discord-modal').style.display = 'none';
        }

        function resetModal() {
            currentStage = 'input';
            document.getElementById('modal-title').innerText = "Enter Discord User ID";
            document.getElementById('discord-id-input').style.display = 'block';
            document.getElementById('discord-id-input').value = '';
            document.getElementById('modal-action-btn').innerText = "Submit";
            document.getElementById('modal-action-btn').style.display = 'block';
            document.getElementById('progress-container').style.display = 'none';
            document.getElementById('loading-text').style.display = 'none';
        }

        async function verifyDiscord() {
            if(currentStage === 'input') {
                const id = document.getElementById('discord-id-input').value;
                if(!id) return alert("Please enter an ID");

                // UI Transition
                document.getElementById('discord-id-input').style.display = 'none';
                document.getElementById('modal-action-btn').style.display = 'none';
                document.getElementById('progress-container').style.display = 'block';
                document.getElementById('loading-text').style.display = 'block';
                
                // Simulate Check
                document.getElementById('progress-bar').style.width = '50%';
                
                try {
                    const req = await fetch('/api/v1/discord/lookup', {
                        method: 'POST',
                        body: JSON.stringify({id})
                    });
                    const res = await req.json();
                    
                    if(res.valid) {
                        currentStage = 'confirm';
                        document.getElementById('progress-container').style.display = 'none';
                        document.getElementById('loading-text').style.display = 'none';
                        document.getElementById('modal-title').innerHTML = `Is your discord username <span style="color:#a855f7">${res.username}</span>?`;
                        
                        // Create Yes/No Buttons
                        const btnContainer = document.createElement('div');
                        btnContainer.id = 'confirm-btns';
                        btnContainer.style.display = 'flex';
                        btnContainer.style.gap = '10px';
                        
                        const yesBtn = document.createElement('button');
                        yesBtn.className = 'modal-btn';
                        yesBtn.innerText = 'Yes';
                        yesBtn.onclick = () => startGeneration(id);
                        
                        const noBtn = document.createElement('button');
                        noBtn.className = 'modal-btn';
                        noBtn.style.background = '#333';
                        noBtn.innerText = 'No';
                        noBtn.onclick = () => {
                            document.getElementById('confirm-btns').remove();
                            resetModal();
                            alert("Enter your Discord ID and make sure its valid.");
                        };

                        btnContainer.appendChild(yesBtn);
                        btnContainer.appendChild(noBtn);
                        document.querySelector('.modal-box').appendChild(btnContainer);

                    } else {
                        resetModal();
                        alert("Enter your Discord ID and make sure its valid.");
                    }
                } catch(e) {
                    resetModal();
                    alert("Connection error.");
                }
            }
        }

        function startGeneration(id) {
            document.getElementById('confirm-btns').remove();
            document.getElementById('modal-title').innerText = "Creating your free version api currently..";
            document.getElementById('progress-container').style.display = 'block';
            document.getElementById('loading-text').style.display = 'block';
            document.getElementById('loading-text').innerText = "0%";

            let p = 0;
            const int = setInterval(() => {
                p += 5;
                document.getElementById('progress-bar').style.width = p + '%';
                document.getElementById('loading-text').innerText = p + '%';
                if(p >= 100) {
                    clearInterval(int);
                    cachedId = id;
                    localStorage.setItem('bp_discord_id', id);
                    closeModal();
                    generateKey(id);
                }
            }, 50);
        }

        async function generateKey(id) {
            try {
                const req = await fetch('/api/v1/keys/generate', {
                    method: 'POST',
                    body: JSON.stringify({ discordId: id })
                });
                const res = await req.json();
                
                if(res.success) {
                    renderKeys(res.keys);
                } else {
                    alert(res.message);
                    if(res.keys) renderKeys(res.keys); // Show existing even if max reached
                }
            } catch(e) {
                alert("Error generating key.");
            }
        }

        function renderKeys(keys) {
            const container = document.getElementById('keys-list');
            container.innerHTML = '';
            keys.forEach(k => {
                const box = document.createElement('div');
                box.className = 'key-box';
                box.innerHTML = `
                    <span class="key-text">${k.key}</span>
                    <button class="copy-btn" onclick="navigator.clipboard.writeText('${k.key}')">Copy</button>
                `;
                container.appendChild(box);
            });
        }
    </script>
</body>
</html>
